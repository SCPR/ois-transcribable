<%=
CSV.generate do |csv|
    csv << ["id", "created_at", "updated_at", "person_name", "district_attorney_file_number", "incident_url", "person_weapon", "person_weapon_specific", "reason_for_shooting", "person_place_of_death", "person_first_name", "person_last_name", "person_ethnicity", "person_gender", "person_manner", "person_cause_a", "person_cause_b", "person_cause_c", "person_cause_d", "person_other_significant_causes", "person_investigator", "person_dme", "person_toxicology_status", "person_media_reports_link", "person_case_status", "person_body_status", "person_age", "in_custody_record_key_number", "coroner_case_number", "year_of_incident", "coroner_police_agency", "drugs", "person_criminal_case_file_number", "person_charges_filed", "notes", "person_signs_of_impairment", "marijuana_alone", "case_doubled_up", "person_shot", "person_killed", "person_wounded", "armed_with_firearm", "armed_with_weapon", "used_vehicle_as_weapon", "person_reached_for_waistband", "person_arrested", "person_fled_by_foot_or_vehicle", "person_signs_of_gang_affiliation", "person_ignored_officer_commands", "person_weapon_recovered", "person_threatened_officer_with_weapon", "person_signs_of_mental_illness", "person_fired_gun_at_officer", "person_pointed_gun_at_officer", "person_shot_in_back", "person_shot_in_head", "person_unarmed", "person_armed", "person_hid_hands_from_officer", "person_grabbed_for_officers_weapon_holster", "law_enforcement_related", "officer_involved", "in_custody", "person_date_of_birth", "person_date_of_death"]
    @people.each do |item|
        person_signs_of_impairment = item.person_signs_of_impairment ? 1 : 0
        marijuana_alone = item.marijuana_alone ? 1 : 0
        case_doubled_up = item.case_doubled_up ? 1 : 0
        person_shot = item.person_shot ? 1 : 0
        person_killed = item.person_killed ? 1 : 0
        person_wounded = item.person_wounded ? 1 : 0
        armed_with_firearm = item.armed_with_firearm ? 1 : 0
        armed_with_weapon = item.armed_with_weapon ? 1 : 0
        used_vehicle_as_weapon = item.used_vehicle_as_weapon ? 1 : 0
        person_reached_for_waistband = item.person_reached_for_waistband ? 1 : 0
        person_arrested = item.person_arrested ? 1 : 0
        person_fled_by_foot_or_vehicle = item.person_fled_by_foot_or_vehicle ? 1 : 0
        person_signs_of_gang_affiliation = item.person_signs_of_gang_affiliation ? 1 : 0
        person_ignored_officer_commands = item.person_ignored_officer_commands ? 1 : 0
        person_weapon_recovered = item.person_weapon_recovered ? 1 : 0
        person_threatened_officer_with_weapon = item.person_threatened_officer_with_weapon ? 1 : 0
        person_signs_of_mental_illness = item.person_signs_of_mental_illness ? 1 : 0
        person_fired_gun_at_officer = item.person_fired_gun_at_officer ? 1 : 0
        person_pointed_gun_at_officer = item.person_pointed_gun_at_officer ? 1 : 0
        person_shot_in_back = item.person_shot_in_back ? 1 : 0
        person_shot_in_head = item.person_shot_in_head ? 1 : 0
        person_unarmed = item.person_unarmed ? 1 : 0
        person_armed = item.person_armed ? 1 : 0
        person_hid_hands_from_officer = item.person_hid_hands_from_officer ? 1 : 0
        person_grabbed_for_officers_weapon_holster = item.person_grabbed_for_officers_weapon_holster ? 1 : 0
        law_enforcement_related = item.law_enforcement_related ? 1 : 0
        officer_involved = item.officer_involved ? 1 : 0
        in_custody = item.in_custody ? 1 : 0

        # fix created_at
        if item.created_at
            created_at_string = item.created_at.strftime "%Y-%m-%d %H:%M"
        else
            created_at_string = "NULL"
        end
        puts created_at_string

        # fix updated_at
        if item.updated_at
            updated_at_string = item.updated_at.strftime "%Y-%m-%d %H:%M"
        else
            updated_at_string = "NULL"
        end
        puts updated_at_string

        # fix person_date_of_birth
        if item.person_date_of_birth
            person_date_of_birth_string = item.person_date_of_birth.strftime "%Y-%m-%d"
        else
            person_date_of_birth_string = "NULL"
        end
        puts person_date_of_birth_string

        # fix the person_date_of_death
        if item.person_date_of_death
            person_date_of_death_string = item.person_date_of_death.strftime "%Y-%m-%d"
        else
            person_date_of_death_string = "NULL"
        end
        puts person_date_of_death_string

        csv << [item.id, created_at_string, updated_at_string, item.person_name, item.district_attorney_file_number, item.incident_url, item.person_weapon, item.person_weapon_specific, item.reason_for_shooting, item.person_place_of_death, item.person_first_name, item.person_last_name, item.person_ethnicity, item.person_gender, item.person_manner, item.person_cause_a, item.person_cause_b, item.person_cause_c, item.person_cause_d, item.person_other_significant_causes, item.person_investigator, item.person_dme, item.person_toxicology_status, item.person_media_reports_link, item.person_case_status, item.person_body_status, item.person_age, item.in_custody_record_key_number, item.coroner_case_number, item.year_of_incident, item.coroner_police_agency, item.drugs, item.person_criminal_case_file_number, item.person_charges_filed, item.notes, person_signs_of_impairment, marijuana_alone, case_doubled_up, person_shot, person_killed, person_wounded, armed_with_firearm, armed_with_weapon, used_vehicle_as_weapon, person_reached_for_waistband, person_arrested, person_fled_by_foot_or_vehicle, person_signs_of_gang_affiliation, person_ignored_officer_commands, person_weapon_recovered, person_threatened_officer_with_weapon, person_signs_of_mental_illness, person_fired_gun_at_officer, person_pointed_gun_at_officer, person_shot_in_back, person_shot_in_head, person_unarmed, person_armed, person_hid_hands_from_officer, person_grabbed_for_officers_weapon_holster, law_enforcement_related, officer_involved, in_custody, person_date_of_birth_string, person_date_of_death_string]
    end
end .html_safe
%>
